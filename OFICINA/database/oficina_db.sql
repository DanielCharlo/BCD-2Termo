-- Banco de Dados - Sistema de Oficina Mecânica
DROP DATABASE IF EXISTS OFICINA;

CREATE DATABASE IF NOT EXISTS OFICINA
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE OFICINA;

-- Tabela: CLIENTE
CREATE TABLE CLIENTE (
    ID_CLIENTE INT AUTO_INCREMENT PRIMARY KEY,
    NOME_CLIENTE VARCHAR(100) NOT NULL,
    TELEFONE_CLIENTE VARCHAR(20) NOT NULL,
    DOCUMENTO VARCHAR(20) NOT NULL UNIQUE,
    ENDERECO_CLIENTE VARCHAR(200) NOT NULL
);

-- Tabela: VEICULO
CREATE TABLE VEICULO (
    ID_VEICULO INT AUTO_INCREMENT PRIMARY KEY,
    ID_CLIENTE INT NOT NULL,
    PLACA VARCHAR(10) NOT NULL UNIQUE,
    MARCA VARCHAR(50) NOT NULL,
    MODELO VARCHAR(50) NOT NULL,
    ANO INT NOT NULL,
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);

-- Tabela: MECANICO
CREATE TABLE MECANICO (
    ID_MECANICO INT AUTO_INCREMENT PRIMARY KEY,
    NOME_MECANICO VARCHAR(100) NOT NULL,
    ESPECIALIDADE VARCHAR(100) NOT NULL,
    TELEFONE VARCHAR(20) NOT NULL
);

-- Tabela: SERVICO
CREATE TABLE SERVICO (
    ID_SERVICO INT AUTO_INCREMENT PRIMARY KEY,
    NOME_SERVICO VARCHAR(100) NOT NULL,
    VALOR_SERVICO DECIMAL(10,2) NOT NULL
);

-- Tabela: PECA
CREATE TABLE PECA (
    ID_PECA INT AUTO_INCREMENT PRIMARY KEY,
    NOME_PECA VARCHAR(100) NOT NULL,
    VALOR_PECA DECIMAL(10,2) NOT NULL,
    QUANTIDADE_ESTOQUE INT NOT NULL DEFAULT 0
);

-- Tabela: OS (Ordem de Serviço)
CREATE TABLE OS (
    ID_OS INT AUTO_INCREMENT PRIMARY KEY,
    ID_VEICULO INT NOT NULL,
    DATA_ABERTURA DATE NOT NULL,
    STATUS_OS VARCHAR(20) DEFAULT 'aberta',
    VALOR_TOTAL DECIMAL(10,2) DEFAULT 0.00,
    FOREIGN KEY (ID_VEICULO) REFERENCES VEICULO(ID_VEICULO)
);

-- Tabela: OS_MECANICO
CREATE TABLE OS_MECANICO (
    ID_OS_MECANICO INT AUTO_INCREMENT PRIMARY KEY,
    ID_OS INT NOT NULL,
    ID_MECANICO INT NOT NULL,
    FOREIGN KEY (ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY (ID_MECANICO) REFERENCES MECANICO(ID_MECANICO)
);

-- Tabela: OS_SERVICO
CREATE TABLE OS_SERVICO (
    ID_OS_SERVICO INT AUTO_INCREMENT PRIMARY KEY,
    ID_OS INT NOT NULL,
    ID_SERVICO INT NOT NULL,
    QUANTIDADE INT DEFAULT 1,
    VALOR_TOTAL DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY (ID_SERVICO) REFERENCES SERVICO(ID_SERVICO)
);

-- Tabela: OS_PECA
CREATE TABLE OS_PECA (
    ID_OS_PECA INT AUTO_INCREMENT PRIMARY KEY,
    ID_OS INT NOT NULL,
    ID_PECA INT NOT NULL,
    QUANTIDADE INT DEFAULT 1,
    VALOR_TOTAL DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (ID_OS) REFERENCES OS(ID_OS),
    FOREIGN KEY (ID_PECA) REFERENCES PECA(ID_PECA)
);

-- Inserir dados de exemplo
INSERT INTO CLIENTE (NOME_CLIENTE, TELEFONE_CLIENTE, DOCUMENTO, ENDERECO_CLIENTE) VALUES
('João Silva', '(11) 98765-4321', '123.456.789-00', 'Rua das Flores, 123'),
('Maria Santos', '(11) 97654-3210', '987.654.321-00', 'Av. Paulista, 1000'),
('Pedro Oliveira', '(11) 96543-2109', '456.789.123-00', 'Rua Augusta, 500');

INSERT INTO VEICULO (ID_CLIENTE, PLACA, MARCA, MODELO, ANO) VALUES
(1, 'ABC-1234', 'Volkswagen', 'Gol', 2020),
(1, 'XYZ-5678', 'Fiat', 'Uno', 2018),
(2, 'DEF-9012', 'Ford', 'Ka', 2021);

INSERT INTO MECANICO (NOME_MECANICO, ESPECIALIDADE, TELEFONE) VALUES
('Roberto Alves', 'Motor', '(11) 91234-5678'),
('Fernando Lima', 'Freios', '(11) 92345-6789'),
('Marcos Souza', 'Elétrica', '(11) 93456-7890');

INSERT INTO SERVICO (NOME_SERVICO, VALOR_SERVICO) VALUES
('Troca de Óleo', 80.00),
('Alinhamento', 120.00),
('Revisão Completa', 350.00),
('Troca de Pastilhas', 200.00);

INSERT INTO PECA (NOME_PECA, VALOR_PECA, QUANTIDADE_ESTOQUE) VALUES
('Filtro de Óleo', 25.00, 50),
('Pastilha de Freio', 80.00, 30),
('Bateria 60Ah', 350.00, 15),
('Óleo Motor 5W30', 120.00, 40);

INSERT INTO OS (ID_VEICULO, DATA_ABERTURA, STATUS_OS, VALOR_TOTAL) VALUES
(1, '2025-01-15', 'finalizada', 430.00),
(2, '2025-01-20', 'em_execucao', 320.00),
(3, '2025-01-22', 'aberta', 80.00);

INSERT INTO OS_MECANICO (ID_OS, ID_MECANICO) VALUES
(1, 1),
(1, 2),
(2, 3);

INSERT INTO OS_SERVICO (ID_OS, ID_SERVICO, QUANTIDADE, VALOR_TOTAL) VALUES
(1, 3, 1, 350.00),
(1, 1, 1, 80.00),
(2, 4, 1, 200.00),
(2, 2, 1, 120.00);

INSERT INTO OS_PECA (ID_OS, ID_PECA, QUANTIDADE, VALOR_TOTAL) VALUES
(1, 1, 1, 25.00),
(1, 4, 1, 120.00),
(2, 2, 2, 160.00);
